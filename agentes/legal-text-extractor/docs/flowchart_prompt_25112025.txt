The Legal Text Extractor pipeline processes Brazilian judicial PDF documents through four sequential stages, each with a specific function and output artifact: Stage 1 (The Cartographer) receives a PDF file as input and performs layout analysis using PyMuPDF to detect page types (TEXT, IMAGE, MIXED) by calculating text coverage ratios, outputting a layout.json file containing per-page metadata including dimensions, text coverage percentage, and classification; Stage 2 (The Sanitizer) takes the PDF and layout.json, applies system-specific artifact removal patterns from validation_artifacts.json to strip PJe/ESAJ/EPROC/STF/STJ digital signatures, QR codes, verification codes, watermarks, and page numbers using regex matching against the SystemPatterns catalog, then performs OCR on image pages using Tesseract with Portuguese language model, outputting cleaned_text.md with raw text free of validation artifacts; Stage 3 (The Extractor) receives cleaned_text.md and applies advanced text cleaning rules from cleaning_rules.py to fix broken words, normalize Unicode (NFKD), correct encoding artifacts, and optionally mask PII (CPF/CNPJ/email/phone), producing final.md with sanitized text in markdown format with page markers like [[PAGE_XXX]] [TYPE: YYY]; Stage 4 (The Librarian) takes final.md and performs semantic classification using legal_taxonomy.json with 12 categories (PETICAO_INICIAL, CONTESTACAO, REPLICA, SENTENCA_DECISAO, DESPACHO, ATOS_ORDINATORIOS, PARECER_MP, RECURSO, ATA_AUDIENCIA, ANEXOS, CAPA_PROCESSO, INDETERMINADO) through adaptive window analysis (15-50 lines) that scores header patterns, synonyms, and footer patterns with priority-weighted scoring, detecting section boundaries via is_section_start and is_section_end flags triggered by confidence thresholds and transition patterns like ANEXO_TRIGGERS for document annexes, ultimately producing semantic_structure.json with per-page classifications and section groupings plus final_tagged.md with semantic tags and table of contents; throughout the pipeline, stages 1-2 are system-aware (they know PJe vs ESAJ vs EPROC patterns) while stages 3-4 are strictly system-agnostic (they work on clean text without knowledge of origin system), enforcing the architectural principle that the same petition filed in different judicial systems must produce identical classification after artifact removal.
